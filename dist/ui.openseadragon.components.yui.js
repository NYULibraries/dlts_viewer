"use strict";function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function ViewerApp(a){function b(a){console.log("on_button_click",a,a.currentTarget),a.preventDefault();var b,c,d=a.currentTarget;/** don't waste time if the button is inactive */d.classList.contains("inactive")||(d.classList.contains("target")?console.log("@TODO: Has target"):(c=d.id,b="button:"+c,console.log("@TODO: Find all targets")),d.classList.contains("on")?(d.classList.remove("on"),d.classList.add("off"),console.log("@TODO: Remove all class"),console.log("".concat(b,":off")),document.dispatchEvent(new CustomEvent("".concat(b,":off"),a))):(d.classList.add("on"),d.classList.remove("off"),console.log("".concat(b,":on")),document.dispatchEvent(new CustomEvent("".concat(b,":on"),a))),console.log("".concat(b,":toggle")),document.dispatchEvent(new CustomEvent("".concat(b,":toggle"),a)));/** if current target has target, get target from data-target */}function c(a){var b=a.currentTarget;/** test if the target is not active */if(a.preventDefault(),b.classList.contains("inactive"))return!1;try{document.getElementsByTagName("body")[0].classList.add("openlayers-loading"),document.dispatchEvent(new CustomEvent("sequence:available",{detail:{operation:a.currentTarget.dataset.operation}}))}catch(a){console.log(a)}}function d(){var a=document.documentElement,b=document.querySelector(".top"),c=document.querySelector("#button-metadata");c&&c.classList.remove("on"),a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen(),b&&c.classList.add("hidden")}function e(){var a=document.querySelector("a.fullscreen"),b=document.querySelector(".top");document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),console.log("click fullscreenOff: @todo blur()"),a&&console.log(a),b&&b.classList.remove("hidden")}function f(b){console.log("change_page");try{var c=b.detail.operation;a.isFullyLoaded=!0;var d=a.nodes.osd,e=d.dataset,f=e.type,g=e.identifier,h=e.service,i=parseInt(d.dataset.sequence,10),j=parseInt(d.dataset.sequenceCount,10),k=[];"decrease"==c&&(--i,1>i&&(i=1),k[0]=i,console.log("decrease",i)),"increase"==c&&(++i,i>j&&(i=j),"single"==d.dataset.view?k[0]=i:1==i%2?(k[0]=i,k[1]=i+1):(k[0]=i-1,k[1]=i)),"toggleview"==c&&("single"==d.dataset.view?(d.dataset.view="doublepage",1==i%2?(k[0]=i,k[1]=i+1):(k[0]=i-1,k[1]=i)):(d.dataset.view="single",k[0]=i)),"change"==c&&(k[0]=i),d.dataset.sequence=k[0];// this.one('.current_page').set('text', to_page);
// this.addClass('loading').show();
var l=k.map(function(a,b){return{tileSource:"".concat(h,"/").concat(f,"/").concat(g,"/").concat(a,"/info.json"),x:b}});document.querySelectorAll(".paging.next").forEach(function(a){i>=j?a.classList.add("inactive"):a.classList.contains("inactive")&&a.classList.remove("inactive")}),document.querySelectorAll(".paging.previous").forEach(function(a){1>=i?a.classList.add("inactive"):a.classList.contains("inactive")&&a.classList.remove("inactive")}),window.history.pushState({},"some title",k[0].toString()),a.Viewer.open(l)}catch(a){console.log(a)}}function g(){var a=document.querySelector("#button-metadata"),b=document.querySelector("#pagemeta");b.classList.remove("hidden"),a.classList.remove("off"),a.classList.add("on"),b.closest(".pane-body").classList.remove("pagemeta-hidden")}function h(){var a=document.querySelector("#button-metadata"),b=document.querySelector("#pagemeta");a.classList.remove("on"),a.classList.add("off"),b.classList.add("hidden"),b.closest(".pane-body").classList.add("pagemeta-hidden")}function i(){var b=a.nodes.body;b.classList.contains("openlayers-loading")?setTimeout(function(){i()},100):(a.hide(".pane.load"),b.classList.remove("openlayers-loading"))}function j(a){console.log("onPjaxLoadAvailable",a)}// function onSelectMVChange(e) {
//   e.halt();
//   const currentTarget = e.currentTarget;
//   const value = currentTarget.one(':checked').get('value');
//   const lang = Y.one('.node-dlts-book').getAttribute('data-lang');
//   const url = value.substring(value.indexOf('::') + 2, value.length) + '/1?lang=' + lang;
//   const data = { url : url };
//   if (window.self === window.top) {
//     window.location.assign(url)
//   }
//   else {
//     Y.CrossFrame.postMessage('parent', JSON.stringify({ fire: 'change:option:multivolume', data }));
//   }
// }
// Y.one('.pane.pager').delegate('submit', pager_form, 'form', slider_datasource);  
// https://javascript.info/event-delegation
// Y.delegate('change', onSelectMVChange, 'body', '.field-name-mv-2016 form');
function k(){a.isFullyLoaded&&a.nodes.body.classList.remove("openlayers-loading")}function l(b){var c=b.item;c.addHandler("fully-loaded-change",function(){var b=m();b!==a.isFullyLoaded&&(a.isFullyLoaded=b,k())})}function m(){for(var b,c=a.Viewer.world.getItemCount(),d=0;d<c;d++)if(b=a.Viewer.world.getItemAt(d),!b.getFullyLoaded())return!1;return!0}function n(){var b=a.nodes.osd;a.show("#".concat(b.id)),a.show("#pager"),a.nodes.html.style.overflow="initial",a.hide("#thumbnails")}function o(){var b=a.nodes.osd,c=b.dataset.uri;a.hide("#".concat(b.id)),a.hide("#pager"),a.nodes.html.style.overflow="initial",a.show("#thumbnails"),axios.get("".concat(c,"/thumbnails?pjax=true&width=").concat("230","&height=").concat("150")).then(function(b){if(200===b.status){var c=new DOMParser,d=c.parseFromString(b.data,"text/html");a.nodes.thumbnails.appendChild(d.querySelector(".thumbnails.container")),document.querySelectorAll(".thumbnails.container a").forEach(function(a){a.addEventListener("click",p,!1)})}})["catch"](function(a){console.log(a)})}function p(b){b.preventDefault();var c=b.currentTarget;a.nodes.osd.dataset.sequence=c.dataset.sequence,a.nodes.html.style.overflow="hidden",a.hide("#thumbnails"),a.show("#openseadragon1"),a.show("#pager"),document.dispatchEvent(new CustomEvent("sequence:available",{detail:{operation:"change"}}))}a.OpenSeadragon=OpenSeadragon,a.show=function(a){document.querySelectorAll(a).forEach(function(a){a.style.display=null,a.style.visibility=null,a.hidden=null})},a.hide=function(a){document.querySelectorAll(a).forEach(function(a){a.style.display="none",a.style.visibility="hidden",a.setAttribute("hidden",!0)})},a.delegate=function(a,b,c,d){console.log(a),console.log(b),console.log(c),console.log(d);var e,f=document.querySelectorAll(a),g=_createForOfIteratorHelper(f);try{for(g.s();!(e=g.n()).done;)element=e.value,element.addEventListener(b,function(a){a.target.matches(c)&&d(a)})}catch(a){g.e(a)}finally{g.f()}},a.Viewer=null,a.isFullyLoaded=!1,a.nodes={},window.addEventListener("load",function(){a.nodes.html=document.querySelector("html"),a.nodes.body=document.querySelector("body"),a.nodes.thumbnails=document.querySelector("#thumbnails"),a.nodes.buttonMetadata=document.querySelector("#button-metadata"),a.nodes.pagemeta=document.querySelector("#pagemeta"),a.nodes.osd=document.querySelector("#openseadragon1"),a.nodes.display=document.getElementById("#display"),a.nodes.togglePage=document.getElementById("toggle-page"),a.nodes.controlZoomOut=document.getElementById("control-zoom-out"),a.nodes.controlZoomIn=document.getElementById("control-zoom-in"),a.nodes.toggleLanguage=document.querySelector("body .language"),document.dispatchEvent(new CustomEvent("viewer:contentready"));var k=a.nodes.osd.dataset.manifest.split(",").map(function(a,b){return{tileSource:a,x:b}});// Zoom out event.
a.Viewer=a.OpenSeadragon({id:a.nodes.osd.id,preserveViewport:!0,showNavigationControl:!1,showZoomControl:!1,showHomeControl:!1,showFullPageControl:!1,visibilityRatio:1,minZoomLevel:0,defaultZoomLevel:0,sequenceMode:!1,tileSources:k}),a.Viewer.world.addHandler("add-item",l),a.nodes.controlZoomIn.onclick=function(){var b=a.Viewer.viewport.getZoom(),c=a.Viewer.viewport.getMaxZoom();b<c&&a.Viewer.viewport.zoomTo(2*b)},a.nodes.controlZoomOut.onclick=function(){var b=a.Viewer.viewport.getZoom(),c=a.Viewer.viewport.getMinZoom(),d=b/2;d>=c?a.Viewer.viewport.zoomTo(d):b>c&&a.Viewer.viewport.zoomTo(c)},a.nodes.togglePage.onclick=function(a){a.preventDefault(),document.dispatchEvent(new CustomEvent("sequence:available",{detail:{operation:a.currentTarget.dataset.operation}}))},window.addEventListener("resize",function(){// slider.set('length' ,(Y.one('#pager').get('offsetWidth') - 120 ));
}),document.querySelectorAll("a.paging").forEach(function(a){a.addEventListener("click",c,!1)}),document.querySelectorAll("a.button").forEach(function(a){a.addEventListener("click",b,!1)}),document.addEventListener("sequence:available",f,!1),document.addEventListener("button:button-metadata:on",g,!1),document.addEventListener("button:button-metadata:off",h,!1),document.addEventListener("button:button-fullscreen:on",d,!1),document.addEventListener("button:button-fullscreen:off",e,!1),document.addEventListener("pjax:load:available",j,!1),document.addEventListener("viewer:contentready",i,!1),document.addEventListener("button:button-thumbnails:on",o,!1),document.addEventListener("button:button-thumbnails:off",n,!1),a.delegate("#thumbnails","click","a",function(a){a.preventDefault();var b=a.target;console.log(b)}),a.delegate("body","change","select",function(a){var b=a.target;axios.get(b.value).then(function(a){if(200===a.status){var b=new DOMParser,c=b.parseFromString(a.data,"text/html"),d=document.querySelector(".view-mode-metadata"),e=c.querySelector(".view-mode-metadata"),f=document.querySelector(".pane.main"),g=document.querySelector("html");g.dir=e.dataset.dir,f.dir=e.dataset.dir,d.dir=e.dataset.dir,d.innerHTML=e.innerHTML}})["catch"](function(a){console.log(a)})})})}ViewerApp({});