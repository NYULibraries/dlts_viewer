(()=>{"use strict";var e={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5,fullscreen:6},t=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],n=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],o=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"],r="undefined"!=typeof window&&void 0!==window.document?window.document:{},a="fullscreenEnabled"in r&&Object.keys(e)||t[0]in r&&t||n[0]in r&&n||o[0]in r&&o||[];const s={requestFullscreen:function(t){return t[a[e.requestFullscreen]]()},requestFullscreenFunction:function(t){return t[a[e.requestFullscreen]]},get exitFullscreen(){return r[a[e.exitFullscreen]].bind(r)},get fullscreenPseudoClass(){return":"+a[e.fullscreen]},addEventListener:function(t,n,o){return r.addEventListener(a[e[t]],n,o)},removeEventListener:function(t,n,o){return r.removeEventListener(a[e[t]],n,o)},get fullscreenEnabled(){return Boolean(r[a[e.fullscreenEnabled]])},set fullscreenEnabled(e){},get fullscreenElement(){return r[a[e.fullscreenElement]]},set fullscreenElement(e){},get onfullscreenchange(){return r[("on"+a[e.fullscreenchange]).toLowerCase()]},set onfullscreenchange(t){return r[("on"+a[e.fullscreenchange]).toLowerCase()]=t},get onfullscreenerror(){return r[("on"+a[e.fullscreenerror]).toLowerCase()]},set onfullscreenerror(t){return r[("on"+a[e.fullscreenerror]).toLowerCase()]=t}};function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function u(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function d(e,t,n,o,r,a,s){try{var c=e[a](s),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(o,r)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var a=e.apply(t,n);function s(e){d(a,o,r,s,c,"next",e)}function c(e){d(a,o,r,s,c,"throw",e)}s(void 0)}))}}function v(){return v=m(regeneratorRuntime.mark((function e(t){var n,o,r,a,u,l,d,v,f,g,p,b,h,y,w,L,q,E,S,x,k,F,C,P,Z,A,V,I,M,R,O,_,z,T,N,D,j,B,H;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D=function(){return D=m(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"rtl"==n.dir&&(t.sequence=t.sequence.reverse()),e.abrupt("return",t.sequence.map((function(e,t){return{tileSource:"".concat(n.service,"/").concat(n.type,"/").concat(n.identifier,"/").concat(e,"/info.json"),x:t}})));case 2:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)},N=function(e,t){return D.apply(this,arguments)},T=function(e){document.querySelectorAll(e).forEach((function(e){e.style.display=null,e.style.visibility=null,e.hidden=null}))},z=function(){return z=m(regeneratorRuntime.mark((function e(n){var o,r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.dataset.sequenceCount,!((r=Math.max.apply(Math,c(t.seqmap.sequence))+1)>Number(o))){e.next=6;break}return e.abrupt("return",o);case 6:n.dataset.sequence=r.toString(),a=document.querySelector("#range_weight"),s=document.querySelector("#slider_value"),a&&s&&(a.value=r,s.value=r);case 10:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)},_=function(e){return z.apply(this,arguments)},O=function(e){document.querySelectorAll(e).forEach((function(e){e.style.display=null,e.style.visibility=null,e.hidden=null,e.height=0}))},R=function(e,t,n,o){var r,a=i(document.querySelectorAll(e));try{for(a.s();!(r=a.n()).done;)r.value.addEventListener(t,(function(e){e.target.matches(n)&&o(e)}))}catch(e){a.e(e)}finally{a.f()}},M=function(){return M=m(regeneratorRuntime.mark((function e(t,n){var o,r,a,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.dataset.sequenceCount,r=Number(t),a=Number(o),!(r<1)){e.next=7;break}return e.abrupt("return",1);case 7:if(!(r>a)){e.next=11;break}return e.abrupt("return",a);case 11:n.dataset.sequence=r.toString(),s=document.querySelector("#range_weight"),c=document.querySelector("#slider_value"),s&&c&&(s.value=t,c.value=t);case 15:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)},I=function(e,t){return M.apply(this,arguments)},V=function(){return(V=m(regeneratorRuntime.mark((function e(n){var o,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((o=Math.min.apply(Math,c(t.seqmap.sequence))-1)<1)){e.next=5;break}return e.abrupt("return",o);case 5:n.dataset.sequence=o.toString(),r=document.querySelector("#range_weight"),a=document.querySelector("#slider_value"),r&&a&&(r.value=o,a.value=o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)},A=function(e){return V.apply(this,arguments)},Z=function(e){document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:"change",to:e.currentTarget.value,trigger:"change"}}))},P=function(e){e.preventDefault();var t=document.getElementById("button-thumbnails");document.querySelector("html").classList.remove("thumbnails-view"),t.classList.contains("on")&&(t.classList.remove("on"),t.classList.add("off")),O("#thumbnails"),document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:"change",to:e.currentTarget.dataset.sequence}}))},C=function(){var e=t.nodes.osd.dataset,n=e.uri;if("photos"!==e.type){var o=t.nodes.thumbnails.dataset.state;document.querySelector("html").classList.add("thumbnails-view");var r=document.querySelector("#control-zoom-in"),a=document.querySelector("#control-zoom-out");r.classList.remove("active"),r.classList.add("inactive"),r.setAttribute("aria-disabled","true"),a.classList.remove("active"),a.classList.add("inactive"),a.setAttribute("aria-disabled","true"),t.nodes.togglePage&&(t.nodes.togglePage.classList.remove("active"),t.nodes.togglePage.classList.add("inactive"),t.nodes.togglePage.setAttribute("aria-disabled","true")),t.nodes.next.forEach((function(e){e.classList.remove("active"),e.classList.add("inactive"),e.setAttribute("aria-disabled","true")})),t.nodes.previous.forEach((function(e){e.classList.remove("active"),e.classList.add("inactive"),e.setAttribute("aria-disabled","true")})),0===Number(o)&&axios.get("".concat(n,"/thumbnails?width=").concat("230","&height=").concat("150")).then((function(e){if(200===e.status){var n=(new DOMParser).parseFromString(e.data,"text/html");t.nodes.thumbnails.appendChild(n.querySelector(".thumbnails.container")),document.querySelectorAll(".thumbnails.container a").forEach((function(e){e.addEventListener("click",P)})),t.nodes.thumbnails.dataset.state=1}T("#thumbnails")})).catch((function(e){console.log(e)}))}else window.location=document.querySelector("#button-thumbnails").href},F=function(){var e=t.nodes.osd.dataset,n=e.sequenceCount,o=e.sequence;document.querySelector("html").classList.remove("thumbnails-view"),O("#thumbnails"),t.nodes.togglePage&&(t.nodes.togglePage.classList.remove("inactive"),t.nodes.togglePage.classList.add("active")),t.nodes.next.forEach((function(e){o<n&&(e.classList.remove("inactive"),e.classList.add("active"))})),t.nodes.previous.forEach((function(e){o>1&&(e.classList.remove("inactive"),e.classList.add("active"))}))},k=function(){for(var e=t.Viewer.world.getItemCount(),n=0;n<e;n++)if(!t.Viewer.world.getItemAt(n).getFullyLoaded())return!1;return!0},x=function(e){t.Viewer.viewport.setRotation(0),e.item.addHandler("fully-loaded-change",(function(){var e=k();e!==t.isFullyLoaded&&(t.isFullyLoaded=e,S())}))},S=function(){t.isFullyLoaded&&(t.nodes.body.classList.remove("openlayers-loading"),O(".pane.load"),d("viewer:loaded",{}))},E=function(){body.classList.contains("openlayers-loading")?setTimeout((function(){E()}),100):(O(".pane.load"),t.nodes.body.classList.remove("openlayers-loading"))},q=function(){var e=document.querySelector("#button-metadata"),t=document.querySelector("#pagemeta");e.classList.remove("on"),e.classList.add("off"),t.classList.add("hidden"),t.closest(".pane-body").classList.add("pagemeta-hidden"),d("button:button-metadata:off",{})},L=function(){var e=document.querySelector("#button-metadata"),t=document.querySelector("#pagemeta");t.classList.remove("hidden"),e.classList.remove("off"),e.classList.add("on"),t.closest(".pane-body").classList.remove("pagemeta-hidden"),d("button:button-metadata:on",{})},w=function(){return(w=m(regeneratorRuntime.mark((function e(n){var o,r,a,s,c,i,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,o=t.nodes.osd,r=o.dataset,a=n.detail,s=a.operation,c=a.to,i="viewer:sequence:".concat(s),e.t0=s,e.next="increase"===e.t0?8:"decrease"===e.t0?11:"change"===e.t0?14:"toggleview"===e.t0?17:19;break;case 8:return e.next=10,_(o);case 10:return e.abrupt("break",19);case 11:return e.next=13,A(o);case 13:return e.abrupt("break",19);case 14:return e.next=16,I(c,o);case 16:return e.abrupt("break",19);case 17:return v(o),e.abrupt("break",19);case 19:return u={id:o.id,title:r.title,count:t.count,view:r.view,current:Number(r.current),sequence:Number(r.sequence),identifier:r.identifier,uri:"".concat(r.uri,"/").concat(r.sequence)},e.next=22,b(u);case 22:return t.seqmap=e.sent,d(i,u),e.next=26,N(t.seqmap,r);case 26:l=e.sent,document.querySelector(".current_page").textContent=t.seqmap.sequence.join(" - "),t.nodes.next.forEach((function(e){r.sequence>=t.seqmap.count?e.classList.add("inactive"):e.classList.contains("inactive")&&e.classList.remove("inactive")})),t.nodes.previous.forEach((function(e){r.sequence<=1?e.classList.add("inactive"):e.classList.contains("inactive")&&e.classList.remove("inactive")})),t.nodes.togglePage&&(t.nodes.togglePage.classList.add("active"),t.nodes.togglePage.classList.remove("inactive")),T("#openseadragon1"),T("#pager"),t.Viewer.open(l),t.nodes.body.classList.remove("openlayers-loading"),t.isFullyLoaded=!0,e.next=41;break;case 38:e.prev=38,e.t1=e.catch(0),console.log(e.t1);case 41:case"end":return e.stop()}}),e,null,[[0,38]])})))).apply(this,arguments)},y=function(e){return w.apply(this,arguments)},h=function(){return h=m(regeneratorRuntime.mark((function e(t){var n,o,r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.count,o=t.view,r=t.sequence,a=[],e.t0=o,e.next="doublepage"===e.t0?5:"single"===e.t0?11:13;break;case 5:return s=Math.ceil(Number(n)/2)+1,Array(s).fill().map((function(e,t){a.push([2*t,2*t+1])})),a[0].shift(),a[a.length-1][1]>n&&a[a.length-1].pop(),a[a.length-1][0]>n&&a.pop(),e.abrupt("return",{sequences:a,count:n,view:o,sequence:a.find((function(e){return!0===e.includes(r)}))});case 11:return Array(Number(n)).fill().map((function(e,t){a.push([t+1])})),e.abrupt("return",{sequences:a,count:n,view:o,sequence:[a.find((function(e){return Number(e)===Number(r)}))]});case 13:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)},b=function(e){return h.apply(this,arguments)},p=function(){s.fullscreenEnabled&&s.fullscreenElement&&(s.exitFullscreen(),d("button:button-fullscreen:off",{}))},g=function(){s.fullscreenEnabled&&!s.fullscreenElement&&(s.requestFullscreen(document.documentElement),d("button:button-fullscreen:on",{}))},f=function(e){var n=e.currentTarget;if(e.preventDefault(),n.classList.contains("inactive"))return!1;try{t.nodes.body.classList.add("openlayers-loading"),document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:e.currentTarget.dataset.operation}}))}catch(e){console.log(e)}},v=function(e){var t=e.dataset.view;"single"==t?e.dataset.view="doublepage":"doublepage"==t&&(e.dataset.view="single")},d=function(e,t){var n=JSON.stringify({fire:e,message:t});window.top.postMessage(n,"*")},t.Viewer=null,t.isFullyLoaded=!1,t.seqmap={},t.nodes={},t.nodes.body=document.querySelector("body"),t.nodes.thumbnails=document.querySelector("#thumbnails"),t.nodes.buttonMetadata=document.querySelector("#button-metadata"),t.nodes.rotate=document.querySelector("#control-rotate"),t.nodes.pagemeta=document.querySelector("#pagemeta"),t.nodes.osd=document.querySelector("#openseadragon1"),t.nodes.display=document.getElementById("#display"),t.nodes.togglePage=document.getElementById("toggle-page"),t.nodes.controlZoomOut=document.getElementById("control-zoom-out"),t.nodes.controlZoomIn=document.getElementById("control-zoom-in"),t.nodes.toggleLanguage=document.querySelector("body .language"),t.nodes.next=document.querySelectorAll(".paging.next"),t.nodes.previous=document.querySelectorAll(".paging.previous"),t.nodes.slider=document.querySelector("#range_weight"),t.nodes.slider_value=document.querySelector("#slider_value"),n=t.nodes.osd.dataset,o=n.view,r=n.sequence,a=n.sequenceCount,u=n.current,l=n.type,s.fullscreenEnabled&&document.querySelector(".navbar-fullscreen").classList.remove("hidden"),t.count=Number(a),s.onfullscreenchange=function(){if(s.fullscreenEnabled&&null===s.fullscreenElement){var e=document.querySelector("#button-fullscreen");e.classList.contains("on")&&e.classList.remove("on")}},d("viewer:init",{}),d("viewer:contentready",{}),document.dispatchEvent(new CustomEvent("viewer:contentready")),"doublepage"==o&&t.nodes.togglePage&&t.nodes.togglePage.classList.contains("page-double")&&(t.nodes.togglePage.classList.remove("page-double"),t.nodes.togglePage.classList.add("page-single")),e.next=59,b({count:t.count,view:o,sequence:r,current:u});case 59:return t.seqmap=e.sent,document.querySelector(".current_page").textContent=t.nodes.osd.dataset.sequence=r,t.nodes.slider&&(t.nodes.slider.value=r),t.nodes.slider_value&&(t.nodes.slider_value.value=r),document.querySelectorAll(".sequence_count").forEach((function(e){e.textContent=t.seqmap.count})),e.next=66,N(t.seqmap,t.nodes.osd.dataset);case 66:j=e.sent,B={id:t.nodes.osd.id,preserveViewport:!0,showNavigationControl:!1,showZoomControl:!1,showHomeControl:!1,showFullPageControl:!1,visibilityRatio:1,minZoomLevel:0,defaultZoomLevel:0,sequenceMode:!1,tileSources:j},"maps"==l&&(B.showNavigator=!0),t.Viewer=t.OpenSeadragon(B),t.Viewer.world.addHandler("add-item",x),t.Viewer.addHandler("zoom",(function(){if(!t.nodes.osd.hidden){var e=t.Viewer.viewport.getZoom(),n=t.Viewer.viewport.getMaxZoom(),o=t.Viewer.viewport.getMinZoom();e<n&&t.nodes.controlZoomIn.classList.contains("inactive")&&(t.nodes.controlZoomIn.classList.remove("inactive"),t.nodes.controlZoomIn.classList.add("active")),e>=n&&(t.nodes.controlZoomIn.classList.add("inactive"),t.nodes.controlZoomIn.classList.remove("active")),e<=o&&(t.nodes.controlZoomOut.classList.add("inactive"),t.nodes.controlZoomOut.classList.remove("active")),e>o&&(t.nodes.controlZoomOut.classList.remove("inactive"),t.nodes.controlZoomOut.classList.add("active"))}})),(H=document.querySelector("#form-update-sequence"))&&t.nodes.slider_value&&(H.onsubmit=function(e){e.preventDefault(),document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:"change",to:t.nodes.slider_value.value,trigger:"onsubmit"}}))}),t.nodes.controlZoomIn.onclick=function(e){e.preventDefault();var n=t.Viewer.viewport.getZoom(),o=t.Viewer.viewport.getMaxZoom(),r=t.Viewer.viewport.getMinZoom(),a=2*n;n<o&&t.Viewer.viewport.zoomTo(a),a>=o&&t.nodes.controlZoomIn.classList.add("inactive"),n>r&&t.nodes.controlZoomOut.classList.contains("inactive")&&t.nodes.controlZoomOut.classList.remove("inactive")},t.nodes.controlZoomOut.onclick=function(e){e.preventDefault();var n=t.Viewer.viewport.getZoom(),o=t.Viewer.viewport.getMinZoom(),r=n/2;r>=o?t.Viewer.viewport.zoomTo(r):n>o&&t.Viewer.viewport.zoomTo(o)},t.nodes.rotate.onclick=function(e){e.preventDefault(),t.Viewer.viewport.setRotation(t.Viewer.viewport.degrees+90)},t.nodes.togglePage&&(t.nodes.togglePage.onclick=function(e){if(e.preventDefault(),e.currentTarget.classList.contains("inactive"))return!1;t.nodes.togglePage.classList.contains("page-double")?(t.nodes.togglePage.classList.remove("page-double"),t.nodes.togglePage.classList.add("page-single")):(t.nodes.togglePage.classList.remove("page-single"),t.nodes.togglePage.classList.add("page-double")),document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:e.currentTarget.dataset.operation}}))}),document.querySelectorAll("a.paging").forEach((function(e){e.addEventListener("click",f)})),document.querySelectorAll("a.button").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault();var t=e.currentTarget,n="button:".concat(t.id);if(t.classList.contains("inactive"))return!1;t.classList.contains("on")?(t.classList.remove("on"),t.classList.add("off"),document.dispatchEvent(new CustomEvent("".concat(n,":off"),e))):(t.classList.add("on"),t.classList.remove("off"),document.dispatchEvent(new CustomEvent("".concat(n,":on"),e))),document.dispatchEvent(new CustomEvent("".concat(n,":toggle"),e))}))})),t.nodes.slider&&t.nodes.slider.addEventListener("change",Z),document.addEventListener("load:sequence",y),window.addEventListener("popstate",(function(e){document.dispatchEvent(new CustomEvent("viewer:popstate",{detail:{operation:"change",to:history.state.sequence,trigger:"popstate"}}))})),document.addEventListener("button:button-metadata:on",L),document.addEventListener("button:button-metadata:off",q),document.addEventListener("button:button-fullscreen:on",g),document.addEventListener("button:button-fullscreen:off",p),document.addEventListener("viewer:contentready",E),document.addEventListener("button:button-thumbnails:on",C),document.addEventListener("button:button-thumbnails:off",F),R("body","change",".lang-options select",(function(e){var t=e.target;axios.get(t.value).then((function(e){if(200===e.status){var t=(new DOMParser).parseFromString(e.data,"text/html"),n=document.querySelector(".view-mode-metadata"),o=t.querySelector(".view-mode-metadata"),r=document.querySelector(".pane.main");document.querySelector("html").dir=o.dataset.dir,r.dir=o.dataset.dir,n.dir=o.dataset.dir,n.innerHTML=o.innerHTML}})).catch((function(e){console.log(e)}))})),R("body","change",".view-mv select",(function(e){var t=e.target.value,n=document.querySelector(".node-dlts-book").dataset.lang,o=t.substring(t.indexOf("::")+2,t.length)+"/1?lang="+n;window.self===window.top?window.location.assign(o):d("change:option:multivolume",o)}));case 92:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}!function(e){v.apply(this,arguments)}({OpenSeadragon:window.OpenSeadragon,axios})})();