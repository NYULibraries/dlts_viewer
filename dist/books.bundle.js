(()=>{function e(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=n(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==o.return||o.return()}finally{if(c)throw s}}}}function n(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t,n,o,r,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(o,r)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var s=e.apply(t,n);function i(e){r(s,o,a,i,c,"next",e)}function c(e){r(s,o,a,i,c,"throw",e)}i(void 0)}))}}function s(){return s=a(regeneratorRuntime.mark((function n(o){var r,s,i,c,u,l,d,m,v,g,p,f,y,h,b,w,q,L,S,E,x,k,C,P,Z,A,F,R,V,I,M,O,_,T,N,z,D,j,H;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return z=function(){return z=a(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.sequence.map((function(e,t){return{tileSource:"".concat(n.service,"/").concat(n.type,"/").concat(n.identifier,"/").concat(e,"/info.json"),x:t}})));case 1:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)},N=function(e,t){return z.apply(this,arguments)},T=function(e){document.querySelectorAll(e).forEach((function(e){e.style.display=null,e.style.visibility=null,e.hidden=null}))},_=function(){return _=a(regeneratorRuntime.mark((function t(n){var r,a,s,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.dataset.sequenceCount,!((a=Math.max.apply(Math,e(o.seqmap.sequence))+1)>Number(r))){t.next=6;break}return t.abrupt("return",r);case 6:n.dataset.sequence=a.toString(),s=document.querySelector("#range_weight"),i=document.querySelector("#slider_value"),s&&i&&(s.value=a,i.value=a);case 10:case"end":return t.stop()}}),t)}))),_.apply(this,arguments)},O=function(e){return _.apply(this,arguments)},M=function(e){document.querySelectorAll(e).forEach((function(e){e.style.display=null,e.style.visibility=null,e.hidden=null,e.height=0}))},I=function(e,n,o,r){var a,s=t(document.querySelectorAll(e));try{for(s.s();!(a=s.n()).done;)a.value.addEventListener(n,(function(e){e.target.matches(o)&&r(e)}))}catch(e){s.e(e)}finally{s.f()}},V=function(){return V=a(regeneratorRuntime.mark((function e(t,n){var o,r,a,s,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.dataset.sequenceCount,r=Number(t),a=Number(o),!(r<1)){e.next=7;break}return e.abrupt("return",1);case 7:if(!(r>a)){e.next=11;break}return e.abrupt("return",a);case 11:n.dataset.sequence=r.toString(),s=document.querySelector("#range_weight"),i=document.querySelector("#slider_value"),s&&i&&(s.value=t,i.value=t);case 15:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)},R=function(e,t){return V.apply(this,arguments)},F=function(){return(F=a(regeneratorRuntime.mark((function t(n){var r,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((r=Math.min.apply(Math,e(o.seqmap.sequence))-1)<1)){t.next=5;break}return t.abrupt("return",r);case 5:n.dataset.sequence=r.toString(),a=document.querySelector("#range_weight"),s=document.querySelector("#slider_value"),a&&s&&(a.value=r,s.value=r);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)},A=function(e){return F.apply(this,arguments)},Z=function(e){document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:"change",to:e.currentTarget.value,trigger:"change"}}))},P=function(e){e.preventDefault();var t=document.getElementById("button-thumbnails");document.querySelector("html").classList.remove("thumbnails-view"),t.classList.contains("on")&&(t.classList.remove("on"),t.classList.add("off")),M("#thumbnails"),document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:"change",to:e.currentTarget.dataset.sequence}}))},C=function(){var e=o.nodes.osd.dataset.uri,t=o.nodes.thumbnails.dataset.state;document.querySelector("html").classList.add("thumbnails-view");var n=document.querySelector("#control-zoom-in"),r=document.querySelector("#control-zoom-out");n.classList.remove("active"),n.classList.add("inactive"),n.setAttribute("aria-disabled","true"),r.classList.remove("active"),r.classList.add("inactive"),r.setAttribute("aria-disabled","true"),o.nodes.togglePage&&(o.nodes.togglePage.classList.remove("active"),o.nodes.togglePage.classList.add("inactive"),o.nodes.togglePage.setAttribute("aria-disabled","true")),o.nodes.next.forEach((function(e){e.classList.remove("active"),e.classList.add("inactive"),e.setAttribute("aria-disabled","true")})),o.nodes.previous.forEach((function(e){e.classList.remove("active"),e.classList.add("inactive"),e.setAttribute("aria-disabled","true")})),0===Number(t)&&axios.get("".concat(e,"/thumbnails?pjax=true&width=").concat("230","&height=").concat("150")).then((function(e){if(200===e.status){var t=(new DOMParser).parseFromString(e.data,"text/html");o.nodes.thumbnails.appendChild(t.querySelector(".thumbnails.container")),document.querySelectorAll(".thumbnails.container a").forEach((function(e){e.addEventListener("click",P)})),o.nodes.thumbnails.dataset.state=1}T("#thumbnails")})).catch((function(e){console.log(e)}))},k=function(){var e=o.nodes.osd.dataset,t=e.sequenceCount,n=e.sequence;document.querySelector("html").classList.remove("thumbnails-view"),M("#thumbnails"),o.nodes.togglePage&&(o.nodes.togglePage.classList.remove("inactive"),o.nodes.togglePage.classList.add("active")),o.nodes.next.forEach((function(e){n<t&&(e.classList.remove("inactive"),e.classList.add("active"))})),o.nodes.previous.forEach((function(e){n>1&&(e.classList.remove("inactive"),e.classList.add("active"))}))},x=function(){for(var e=o.Viewer.world.getItemCount(),t=0;t<e;t++)if(!o.Viewer.world.getItemAt(t).getFullyLoaded())return!1;return!0},E=function(e){o.Viewer.viewport.setRotation(0),e.item.addHandler("fully-loaded-change",(function(){var e=x();e!==o.isFullyLoaded&&(o.isFullyLoaded=e,S())}))},S=function(){o.isFullyLoaded&&(o.nodes.body.classList.remove("openlayers-loading"),M(".pane.load"),d("viewer:loaded",{}))},L=function(){body.classList.contains("openlayers-loading")?setTimeout((function(){L()}),100):(M(".pane.load"),o.nodes.body.classList.remove("openlayers-loading"))},q=function(){var e=document.querySelector("#button-metadata"),t=document.querySelector("#pagemeta");e.classList.remove("on"),e.classList.add("off"),t.classList.add("hidden"),t.closest(".pane-body").classList.add("pagemeta-hidden"),d("button:button-metadata:off",{})},w=function(){var e=document.querySelector("#button-metadata"),t=document.querySelector("#pagemeta");t.classList.remove("hidden"),e.classList.remove("off"),e.classList.add("on"),t.closest(".pane-body").classList.remove("pagemeta-hidden"),d("button:button-metadata:on",{})},b=function(){return(b=a(regeneratorRuntime.mark((function e(t){var n,r,a,s,i,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=o.nodes.osd,r=n.dataset,a=t.detail,s=a.operation,i=a.to,c="viewer:sequence:".concat(s),e.t0=s,e.next="increase"===e.t0?8:"decrease"===e.t0?11:"change"===e.t0?14:"toggleview"===e.t0?17:19;break;case 8:return e.next=10,O(n);case 10:return e.abrupt("break",19);case 11:return e.next=13,A(n);case 13:return e.abrupt("break",19);case 14:return e.next=16,R(i,n);case 16:return e.abrupt("break",19);case 17:return m(n),e.abrupt("break",19);case 19:return u={id:n.id,title:r.title,count:o.count,view:r.view,current:Number(r.current),sequence:Number(r.sequence),identifier:r.identifier,uri:"".concat(r.uri,"/").concat(r.sequence)},e.next=22,f(u);case 22:return o.seqmap=e.sent,d(c,u),e.next=26,N(o.seqmap,r);case 26:l=e.sent,document.querySelector(".current_page").textContent=o.seqmap.sequence.join(" - "),o.nodes.next.forEach((function(e){r.sequence>=o.seqmap.count?e.classList.add("inactive"):e.classList.contains("inactive")&&e.classList.remove("inactive")})),o.nodes.previous.forEach((function(e){r.sequence<=1?e.classList.add("inactive"):e.classList.contains("inactive")&&e.classList.remove("inactive")})),o.nodes.togglePage&&(o.nodes.togglePage.classList.add("active"),o.nodes.togglePage.classList.remove("inactive")),T("#openseadragon1"),T("#pager"),o.Viewer.open(l),o.nodes.body.classList.remove("openlayers-loading"),o.isFullyLoaded=!0,e.next=41;break;case 38:e.prev=38,e.t1=e.catch(0),console.log(e.t1);case 41:case"end":return e.stop()}}),e,null,[[0,38]])})))).apply(this,arguments)},h=function(e){return b.apply(this,arguments)},y=function(){return y=a(regeneratorRuntime.mark((function e(t){var n,o,r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.count,o=t.view,r=t.sequence,a=[],e.t0=o,e.next="doublepage"===e.t0?5:"single"===e.t0?11:13;break;case 5:return s=Math.ceil(Number(n)/2)+1,Array(s).fill().map((function(e,t){a.push([2*t,2*t+1])})),a[0].shift(),a[a.length-1][1]>n&&a[a.length-1].pop(),a[a.length-1][0]>n&&a.pop(),e.abrupt("return",{sequences:a,count:n,view:o,sequence:a.find((function(e){return!0===e.includes(r)}))});case 11:return Array(Number(n)).fill().map((function(e,t){a.push([t+1])})),e.abrupt("return",{sequences:a,count:n,view:o,sequence:[a.find((function(e){return Number(e)===Number(r)}))]});case 13:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)},f=function(e){return y.apply(this,arguments)},p=function(){var e=document.querySelector(".top");document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),e&&e.classList.remove("hidden"),d("button:button-fullscreen:off",{})},g=function(){var e=document.documentElement,t=document.querySelector(".top"),n=document.querySelector("#button-metadata");n&&n.classList.remove("on"),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(),t&&n.classList.add("hidden"),d("button:button-fullscreen:on",{})},v=function(e){var t=e.currentTarget;if(e.preventDefault(),t.classList.contains("inactive"))return!1;try{o.nodes.body.classList.add("openlayers-loading"),document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:e.currentTarget.dataset.operation}}))}catch(e){console.log(e)}},m=function(e){var t=e.dataset.view;"single"==t?e.dataset.view="doublepage":"doublepage"==t&&(e.dataset.view="single")},d=function(e,t){var n=JSON.stringify({fire:e,message:t});window.top.postMessage(n,"*")},o.Viewer=null,o.isFullyLoaded=!1,o.seqmap={},o.nodes={},o.nodes.body=document.querySelector("body"),o.nodes.thumbnails=document.querySelector("#thumbnails"),o.nodes.buttonMetadata=document.querySelector("#button-metadata"),o.nodes.rotate=document.querySelector("#control-rotate"),o.nodes.pagemeta=document.querySelector("#pagemeta"),o.nodes.osd=document.querySelector("#openseadragon1"),o.nodes.display=document.getElementById("#display"),o.nodes.togglePage=document.getElementById("toggle-page"),o.nodes.controlZoomOut=document.getElementById("control-zoom-out"),o.nodes.controlZoomIn=document.getElementById("control-zoom-in"),o.nodes.toggleLanguage=document.querySelector("body .language"),o.nodes.next=document.querySelectorAll(".paging.next"),o.nodes.previous=document.querySelectorAll(".paging.previous"),o.nodes.slider=document.querySelector("#range_weight"),o.nodes.slider_value=document.querySelector("#slider_value"),r=o.nodes.osd.dataset,s=r.view,i=r.sequence,c=r.sequenceCount,u=r.current,l=r.type,o.count=Number(c),d("viewer:init",{}),d("viewer:contentready",{}),document.dispatchEvent(new CustomEvent("viewer:contentready")),"doublepage"==s&&o.nodes.togglePage&&o.nodes.togglePage.classList.contains("page-double")&&(o.nodes.togglePage.classList.remove("page-double"),o.nodes.togglePage.classList.add("page-single")),n.next=57,f({count:o.count,view:s,sequence:i,current:u});case 57:return o.seqmap=n.sent,document.querySelector(".current_page").textContent=o.nodes.osd.dataset.sequence=i,o.nodes.slider&&(o.nodes.slider.value=i),o.nodes.slider_value&&(o.nodes.slider_value.value=i),document.querySelectorAll(".sequence_count").forEach((function(e){e.textContent=o.seqmap.count})),n.next=64,N(o.seqmap,o.nodes.osd.dataset);case 64:D=n.sent,j={id:o.nodes.osd.id,preserveViewport:!0,showNavigationControl:!1,showZoomControl:!1,showHomeControl:!1,showFullPageControl:!1,visibilityRatio:1,minZoomLevel:0,defaultZoomLevel:0,sequenceMode:!1,tileSources:D},"maps"==l&&(j.showNavigator=!0),o.Viewer=o.OpenSeadragon(j),o.Viewer.world.addHandler("add-item",E),o.Viewer.addHandler("zoom",(function(){if(!o.nodes.osd.hidden){var e=o.Viewer.viewport.getZoom(),t=o.Viewer.viewport.getMaxZoom(),n=o.Viewer.viewport.getMinZoom();e<t&&o.nodes.controlZoomIn.classList.contains("inactive")&&(o.nodes.controlZoomIn.classList.remove("inactive"),o.nodes.controlZoomIn.classList.add("active")),e>=t&&(o.nodes.controlZoomIn.classList.add("inactive"),o.nodes.controlZoomIn.classList.remove("active")),e<=n&&(o.nodes.controlZoomOut.classList.add("inactive"),o.nodes.controlZoomOut.classList.remove("active")),e>n&&(o.nodes.controlZoomOut.classList.remove("inactive"),o.nodes.controlZoomOut.classList.add("active"))}})),(H=document.querySelector("#form-update-sequence"))&&o.nodes.slider_value&&(H.onsubmit=function(e){e.preventDefault(),document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:"change",to:o.nodes.slider_value.value,trigger:"onsubmit"}}))}),o.nodes.controlZoomIn.onclick=function(e){e.preventDefault();var t=o.Viewer.viewport.getZoom(),n=o.Viewer.viewport.getMaxZoom(),r=o.Viewer.viewport.getMinZoom(),a=2*t;t<n&&o.Viewer.viewport.zoomTo(a),a>=n&&o.nodes.controlZoomIn.classList.add("inactive"),t>r&&o.nodes.controlZoomOut.classList.contains("inactive")&&o.nodes.controlZoomOut.classList.remove("inactive")},o.nodes.controlZoomOut.onclick=function(e){e.preventDefault();var t=o.Viewer.viewport.getZoom(),n=o.Viewer.viewport.getMinZoom(),r=t/2;r>=n?o.Viewer.viewport.zoomTo(r):t>n&&o.Viewer.viewport.zoomTo(n)},o.nodes.rotate.onclick=function(e){e.preventDefault(),o.Viewer.viewport.setRotation(o.Viewer.viewport.degrees+90)},o.nodes.togglePage&&(o.nodes.togglePage.onclick=function(e){if(e.preventDefault(),e.currentTarget.classList.contains("inactive"))return!1;o.nodes.togglePage.classList.contains("page-double")?(o.nodes.togglePage.classList.remove("page-double"),o.nodes.togglePage.classList.add("page-single")):(o.nodes.togglePage.classList.remove("page-single"),o.nodes.togglePage.classList.add("page-double")),document.dispatchEvent(new CustomEvent("load:sequence",{detail:{operation:e.currentTarget.dataset.operation}}))}),document.querySelectorAll("a.paging").forEach((function(e){e.addEventListener("click",v)})),document.querySelectorAll("a.button").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault();var t=e.currentTarget,n="button:".concat(t.id);if(t.classList.contains("inactive"))return!1;t.classList.contains("on")?(t.classList.remove("on"),t.classList.add("off"),document.dispatchEvent(new CustomEvent("".concat(n,":off"),e))):(t.classList.add("on"),t.classList.remove("off"),document.dispatchEvent(new CustomEvent("".concat(n,":on"),e))),document.dispatchEvent(new CustomEvent("".concat(n,":toggle"),e))}))})),o.nodes.slider&&o.nodes.slider.addEventListener("change",Z),document.addEventListener("load:sequence",h),window.addEventListener("popstate",(function(e){console.log(e),document.dispatchEvent(new CustomEvent("viewer:popstate",{detail:{operation:"change",to:history.state.sequence,trigger:"popstate"}}))})),document.addEventListener("button:button-metadata:on",w),document.addEventListener("button:button-metadata:off",q),document.addEventListener("button:button-fullscreen:on",g),document.addEventListener("button:button-fullscreen:off",p),document.addEventListener("viewer:contentready",L),document.addEventListener("button:button-thumbnails:on",C),document.addEventListener("button:button-thumbnails:off",k),I("body","change",".lang-options select",(function(e){var t=e.target;axios.get(t.value).then((function(e){if(200===e.status){var t=(new DOMParser).parseFromString(e.data,"text/html"),n=document.querySelector(".view-mode-metadata"),o=t.querySelector(".view-mode-metadata"),r=document.querySelector(".pane.main");document.querySelector("html").dir=o.dataset.dir,r.dir=o.dataset.dir,n.dir=o.dataset.dir,n.innerHTML=o.innerHTML}})).catch((function(e){console.log(e)}))})),I("body","change",".view-mv select",(function(e){var t=e.target.value,n=document.querySelector(".node-dlts-book").dataset.lang,o=t.substring(t.indexOf("::")+2,t.length)+"/1?lang="+n;window.self===window.top?window.location.assign(o):d("change:option:multivolume",o)}));case 90:case"end":return n.stop()}}),n)}))),s.apply(this,arguments)}!function(e){s.apply(this,arguments)}({OpenSeadragon:window.OpenSeadragon,axios})})();